# this cfg" will run single/multi particle pt-gun
# the pt of the particles will be uniformly
# distributed in the user-specifed pt-range 

# this cfg" will then run the simulation and reconstruction
# chain upto debug tracks from a simple helix fit

# $Id$
#
# Copied from RecoTracker/RoadSearchCloudMaker/test
#

process RoadSearch = 
{

  # initialize  MessageLogger
  include "Configuration/Application/data/messages.cfi"
 
  # initialize magnetic field
  include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"

  # geometry
  include "Geometry/CMSCommonData/data/cmsIdealGeometryXML.cfi"

  # tracker geometry
  include "Geometry/TrackerGeometryBuilder/data/trackerGeometry.cfi"

  # tracker numbering
  include "Geometry/TrackerNumberingBuilder/data/trackerNumberingGeometry.cfi"

  # strip parameter estimator service for SiStripRecHitConverter
  include "RecoLocalTracker/SiStripRecHitConverter/data/StripCPEfromTrackAngle.cfi"

  # roads             
  include "RecoTracker/RoadMapESSource/data/RoadMapESSource.cfi"

  service = RandomNumberGeneratorService
  {
    untracked uint32 sourceSeed = 98765
  }

  source = FlatRandomPtGunSource 
  { 
    untracked int32 maxEvents = 10
    PSet PGunParameters =
    {
      # you can request more than 1 particle
      #vint32  PartID = {211,11}
      #vint32 PartID = {211} 
      #vint32  PartID = {13,-13}
      vint32  PartID = {13}
      double MinEta = -1.5
      double MaxEta =  1.5
      double MinPhi = -3.14159265358979323846 # in radians
      double MaxPhi =  3.14159265358979323846
      double MinPt  =  9.99
      double MaxPt  = 10.01
    }
  }
    
  # include geant4 simulation
  include "Configuration/Application/data/reco-application-SimG4Object.cfi"

  # include SiStripDigitizer
  include "SimTracker/SiStripDigitizer/data/SiStripDigi.cfi"

  # swich off Noise in digitization
  replace stripdigi.NoNoise = true

  # include SiStripClusterizer (for now from test area, waiting to modify default parameters in cfi, then switch to cfi from SiStripClusterizer area)
  include "Configuration/Application/data/reco-application-SiStripClusterizer.cfi"
  #include "RecoLocalTracker/SiStripClusterizer/data/SiStripClusterizer.cfi"

  # include SiStripRecHitConverter
  include "RecoLocalTracker/SiStripRecHitConverter/data/SiStripRecHitConverter.cfi"

  # RoadSearchSeedFinder
  include "RecoTracker/RoadSearchSeedFinder/data/RoadSearchSeedFinder.cfi"

  # RoadSearchCloudMaker
  include "RecoTracker/RoadSearchCloudMaker/data/RoadSearchCloudMaker.cfi"

  # RoadSearchCloudCleaner
  include "RecoTracker/RoadSearchCloudCleaner/data/RoadSearchCloudCleaner.cfi"

  # RoadSearchTrackCandidateMaker
  include "RecoTracker/RoadSearchTrackCandidateMaker/data/RoadSearchTrackCandidateMaker.cfi"

  # RoadSearchHelixMaker
  include "RecoTracker/RoadSearchHelixMaker/data/RoadSearchHelixMaker.cfi"

  es_module p1 = AnalyticalPropagatorESProducer
  {
    string ComponentName = "AnalyticalPropagator"   
    string PropagationDirection = "alongMomentum"
  }

  es_module p2 = AnalyticalPropagatorESProducer
  {
    string ComponentName = "AnalyticalPropagatorOpposite"   
    string PropagationDirection = "oppositeToMomentum"
  }
  
  es_module = KFUpdatorESProducer
  {
    string ComponentName = "KFUpdator"   
  }

  es_module = Chi2MeasurementEstimatorESProducer
  {
    string ComponentName = "Chi2"   
    double MaxChi2 = 1. 
    double nSigma = 3.
  }

  es_module = KFTrajectoryFitterESProducer 
  {
    string ComponentName = "KFFitter"   
    string  Propagator = "AnalyticalPropagator" 
    string Updator = "KFUpdator"
    string Estimator = "Chi2"
  }

  es_module = KFTrajectorySmootherESProducer 
  {
    string ComponentName = "KFSmoother"   
    string Propagator = "AnalyticalPropagatorOpposite" 
    string Updator = "KFUpdator"
    string Estimator = "Chi2"

  }

  es_module = KFFittingSmootherESProducer 
  {
    string ComponentName = "KFFittingSmoother"   
    string  Fitter = "KFFitter" 
    string Smoother = "KFSmoother"

  }
  
  module trackp = TrackProducer 
  {
    string Fitter = "KFFittingSmoother"   
    string Propagator = "AnalyticalPropagator" 
    string src = "trackcandidates"
  }

  module AsciiOutput = AsciiOutputModule {}

  module AllTracks = PoolOutputModule 
  { 
    untracked string fileName = "Sim_10mum_To_AllTracks.root"
  }

  path p = 
  {
    SimG4Object,
    stripdigi,
    ThreeThresholdClusterizer,
    LocalMeasurementConverter,
    RoadSearchSeeds,
    RawRoadSearchClouds,
    CleanRoadSearchClouds,
    RoadSearchTrackCandidates,
    RoadSearchDebugTracks,
    trackp
  }

  endpath e = 
  {
    AsciiOutput,AllTracks
  }
}

